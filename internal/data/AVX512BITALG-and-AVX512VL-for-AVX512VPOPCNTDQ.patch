From 6199bfafdeb41dedcbbfaa3ae421a31f8978608d Mon Sep 17 00:00:00 2001
From: Vaughn Iverson <vsivsi@yahoo.com>
Date: Mon, 15 Nov 2021 13:34:10 -0800
Subject: [PATCH] Adds AVX512BITALG and AVX512VL for AVX512VPOPCNTDQ

---
 internal/data/x86_64.xml | 292 +++++++++++++++++++++++++++++++++++++++
 1 file changed, 292 insertions(+)

diff --git a/internal/data/x86_64.xml b/internal/data/x86_64.xml
index a153c31..ec140e0 100644
--- a/internal/data/x86_64.xml
+++ b/internal/data/x86_64.xml
@@ -58299,7 +58299,117 @@
       </Encoding>
     </InstructionForm>
   </Instruction>
+  <Instruction name="VPOPCNTB" summary="Packed Population Count for Byte Integers">
+    <InstructionForm gas-name="vpopcntb" xmm-mode="AVX">
+      <ISA id="AVX512BITALG"/>
+      <ISA id="AVX512VL"/>
+      <Operand type="xmm{k}{z}" input="false" output="true"/>
+      <Operand type="m128" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="00" W="0" vvvv="0000" V="0" RR="#0" B="#1" X="#1" b="0" aaa="#0" z="#0" disp8xN="16"/>
+        <Opcode byte="54"/>
+        <ModRM mode="#1" reg="#0" rm="#1"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpopcntb" xmm-mode="AVX">
+      <ISA id="AVX512BITALG"/>
+      <ISA id="AVX512VL"/>
+      <Operand type="xmm{k}{z}" input="false" output="true"/>
+      <Operand type="xmm" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="00" W="0" vvvv="0000" V="0" RR="#0" B="#1" X="#1" b="0" aaa="#0" z="#0"/>
+        <Opcode byte="54"/>
+        <ModRM mode="11" reg="#0" rm="#1"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpopcntb" xmm-mode="AVX">
+      <ISA id="AVX512BITALG"/>
+      <ISA id="AVX512VL"/>
+      <Operand type="ymm{k}{z}" input="false" output="true"/>
+      <Operand type="m256" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="01" W="0" vvvv="0000" V="0" RR="#0" B="#1" X="#1" b="0" aaa="#0" z="#0" disp8xN="32"/>
+        <Opcode byte="54"/>
+        <ModRM mode="#1" reg="#0" rm="#1"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpopcntb" xmm-mode="AVX">
+      <ISA id="AVX512BITALG"/>
+      <ISA id="AVX512VL"/>
+      <Operand type="ymm{k}{z}" input="false" output="true"/>
+      <Operand type="ymm" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="01" W="0" vvvv="0000" V="0" RR="#0" B="#1" X="#1" b="0" aaa="#0" z="#0"/>
+        <Opcode byte="54"/>
+        <ModRM mode="11" reg="#0" rm="#1"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpopcntb" xmm-mode="AVX">
+      <ISA id="AVX512BITALG"/>
+      <Operand type="zmm{k}{z}" input="false" output="true"/>
+      <Operand type="m512" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="10" W="0" vvvv="0000" V="0" RR="#0" B="#1" X="#1" b="0" aaa="#0" z="#0" disp8xN="64"/>
+        <Opcode byte="54"/>
+        <ModRM mode="#1" reg="#0" rm="#1"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpopcntb" xmm-mode="AVX">
+      <ISA id="AVX512BITALG"/>
+      <Operand type="zmm{k}{z}" input="false" output="true"/>
+      <Operand type="zmm" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="10" W="0" vvvv="0000" V="0" RR="#0" B="#1" X="#1" b="0" aaa="#0" z="#0"/>
+        <Opcode byte="54"/>
+        <ModRM mode="11" reg="#0" rm="#1"/>
+      </Encoding>
+    </InstructionForm>
+  </Instruction>
   <Instruction name="VPOPCNTD" summary="Packed Population Count for Doubleword Integers">
+    <InstructionForm gas-name="vpopcntd" xmm-mode="AVX">
+      <ISA id="AVX512VPOPCNTDQ"/>
+      <ISA id="AVX512VL"/>
+      <Operand type="xmm{k}{z}" input="false" output="true"/>
+      <Operand type="m128/m32bcst" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="00" W="0" vvvv="0000" V="0" RR="#0" B="#1" X="#1" b="#1" aaa="#0" z="#0" disp8xN="16"/>
+        <Opcode byte="55"/>
+        <ModRM mode="#1" reg="#0" rm="#1"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpopcntd" xmm-mode="AVX">
+      <ISA id="AVX512VPOPCNTDQ"/>
+      <ISA id="AVX512VL"/>
+      <Operand type="xmm{k}{z}" input="false" output="true"/>
+      <Operand type="xmm" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="00" W="0" vvvv="0000" V="0" RR="#0" B="#1" X="#1" b="0" aaa="#0" z="#0"/>
+        <Opcode byte="55"/>
+        <ModRM mode="11" reg="#0" rm="#1"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpopcntd" xmm-mode="AVX">
+      <ISA id="AVX512VPOPCNTDQ"/>
+      <ISA id="AVX512VL"/>
+      <Operand type="ymm{k}{z}" input="false" output="true"/>
+      <Operand type="m256/m32bcst" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="01" W="0" vvvv="0000" V="0" RR="#0" B="#1" X="#1" b="#1" aaa="#0" z="#0" disp8xN="32"/>
+        <Opcode byte="55"/>
+        <ModRM mode="#1" reg="#0" rm="#1"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpopcntd" xmm-mode="AVX">
+      <ISA id="AVX512VPOPCNTDQ"/>
+      <ISA id="AVX512VL"/>
+      <Operand type="ymm{k}{z}" input="false" output="true"/>
+      <Operand type="ymm" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="01" W="0" vvvv="0000" V="0" RR="#0" B="#1" X="#1" b="0" aaa="#0" z="#0"/>
+        <Opcode byte="55"/>
+        <ModRM mode="11" reg="#0" rm="#1"/>
+      </Encoding>
+    </InstructionForm>
     <InstructionForm gas-name="vpopcntd" xmm-mode="AVX">
       <ISA id="AVX512VPOPCNTDQ"/>
       <Operand type="zmm{k}{z}" input="false" output="true"/>
@@ -58322,6 +58432,50 @@
     </InstructionForm>
   </Instruction>
   <Instruction name="VPOPCNTQ" summary="Packed Population Count for Quadword Integers">
+    <InstructionForm gas-name="vpopcntq" xmm-mode="AVX">
+      <ISA id="AVX512VPOPCNTDQ"/>
+      <ISA id="AVX512VL"/>
+      <Operand type="xmm{k}{z}" input="false" output="true"/>
+      <Operand type="m128/m64bcst" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="00" W="1" vvvv="0000" V="0" RR="#0" B="#1" X="#1" b="#1" aaa="#0" z="#0" disp8xN="16"/>
+        <Opcode byte="55"/>
+        <ModRM mode="#1" reg="#0" rm="#1"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpopcntq" xmm-mode="AVX">
+      <ISA id="AVX512VPOPCNTDQ"/>
+      <ISA id="AVX512VL"/>
+      <Operand type="xmm{k}{z}" input="false" output="true"/>
+      <Operand type="xmm" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="00" W="1" vvvv="0000" V="0" RR="#0" B="#1" X="#1" b="0" aaa="#0" z="#0"/>
+        <Opcode byte="55"/>
+        <ModRM mode="11" reg="#0" rm="#1"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpopcntq" xmm-mode="AVX">
+      <ISA id="AVX512VPOPCNTDQ"/>
+      <ISA id="AVX512VL"/>
+      <Operand type="ymm{k}{z}" input="false" output="true"/>
+      <Operand type="m256/m64bcst" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="01" W="1" vvvv="0000" V="0" RR="#0" B="#1" X="#1" b="#1" aaa="#0" z="#0" disp8xN="32"/>
+        <Opcode byte="55"/>
+        <ModRM mode="#1" reg="#0" rm="#1"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpopcntq" xmm-mode="AVX">
+      <ISA id="AVX512VPOPCNTDQ"/>
+      <ISA id="AVX512VL"/>
+      <Operand type="ymm{k}{z}" input="false" output="true"/>
+      <Operand type="ymm" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="01" W="1" vvvv="0000" V="0" RR="#0" B="#1" X="#1" b="0" aaa="#0" z="#0"/>
+        <Opcode byte="55"/>
+        <ModRM mode="11" reg="#0" rm="#1"/>
+      </Encoding>
+    </InstructionForm>
     <InstructionForm gas-name="vpopcntq" xmm-mode="AVX">
       <ISA id="AVX512VPOPCNTDQ"/>
       <Operand type="zmm{k}{z}" input="false" output="true"/>
@@ -58343,6 +58497,72 @@
       </Encoding>
     </InstructionForm>
   </Instruction>
+  <Instruction name="VPOPCNTW" summary="Packed Population Count for Word Integers">
+    <InstructionForm gas-name="vpopcntw" xmm-mode="AVX">
+      <ISA id="AVX512BITALG"/>
+      <ISA id="AVX512VL"/>
+      <Operand type="xmm{k}{z}" input="false" output="true"/>
+      <Operand type="m128" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="00" W="1" vvvv="0000" V="0" RR="#0" B="#1" X="#1" b="0" aaa="#0" z="#0" disp8xN="16"/>
+        <Opcode byte="54"/>
+        <ModRM mode="#1" reg="#0" rm="#1"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpopcntw" xmm-mode="AVX">
+      <ISA id="AVX512BITALG"/>
+      <ISA id="AVX512VL"/>
+      <Operand type="xmm{k}{z}" input="false" output="true"/>
+      <Operand type="xmm" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="00" W="1" vvvv="0000" V="0" RR="#0" B="#1" X="#1" b="0" aaa="#0" z="#0"/>
+        <Opcode byte="54"/>
+        <ModRM mode="11" reg="#0" rm="#1"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpopcntw" xmm-mode="AVX">
+      <ISA id="AVX512BITALG"/>
+      <ISA id="AVX512VL"/>
+      <Operand type="ymm{k}{z}" input="false" output="true"/>
+      <Operand type="m256" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="01" W="1" vvvv="0000" V="0" RR="#0" B="#1" X="#1" b="0" aaa="#0" z="#0" disp8xN="32"/>
+        <Opcode byte="54"/>
+        <ModRM mode="#1" reg="#0" rm="#1"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpopcntw" xmm-mode="AVX">
+      <ISA id="AVX512BITALG"/>
+      <ISA id="AVX512VL"/>
+      <Operand type="ymm{k}{z}" input="false" output="true"/>
+      <Operand type="ymm" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="01" W="1" vvvv="0000" V="0" RR="#0" B="#1" X="#1" b="0" aaa="#0" z="#0"/>
+        <Opcode byte="54"/>
+        <ModRM mode="11" reg="#0" rm="#1"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpopcntw" xmm-mode="AVX">
+      <ISA id="AVX512BITALG"/>
+      <Operand type="zmm{k}{z}" input="false" output="true"/>
+      <Operand type="m512" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="10" W="1" vvvv="0000" V="0" RR="#0" B="#1" X="#1" b="0" aaa="#0" z="#0" disp8xN="64"/>
+        <Opcode byte="54"/>
+        <ModRM mode="#1" reg="#0" rm="#1"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpopcntw" xmm-mode="AVX">
+      <ISA id="AVX512BITALG"/>
+      <Operand type="zmm{k}{z}" input="false" output="true"/>
+      <Operand type="zmm" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="10" W="1" vvvv="0000" V="0" RR="#0" B="#1" X="#1" b="0" aaa="#0" z="#0"/>
+        <Opcode byte="54"/>
+        <ModRM mode="11" reg="#0" rm="#1"/>
+      </Encoding>
+    </InstructionForm>
+  </Instruction>
   <Instruction name="VPOR" summary="Packed Bitwise Logical OR">
     <InstructionForm gas-name="vpor" xmm-mode="AVX" nacl-version="41">
       <ISA id="AVX"/>
@@ -60124,6 +60344,78 @@
       </Encoding>
     </InstructionForm>
   </Instruction>
+  <Instruction name="VPSHUFBITQMB" summary="Shuffle Bits from Quadword Elements Using Byte Indexes into Mask">
+    <InstructionForm gas-name="vpshufbitqmb" xmm-mode="AVX">
+      <ISA id="AVX512BITALG"/>
+      <ISA id="AVX512VL"/>
+      <Operand type="k{k}" input="false" output="true"/>
+      <Operand type="xmm" input="true" output="false"/>
+      <Operand type="m128" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="00" W="0" vvvv="#1" V="#1" RR="#0" B="#2" X="#2" b="#2" aaa="#0" z="0" disp8xN="16"/>
+        <Opcode byte="8F"/>
+        <ModRM mode="#2" reg="#0" rm="#2"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpshufbitqmb" xmm-mode="AVX">
+      <ISA id="AVX512BITALG"/>
+      <ISA id="AVX512VL"/>
+      <Operand type="k{k}" input="false" output="true"/>
+      <Operand type="xmm" input="true" output="false"/>
+      <Operand type="xmm" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="00" W="0" vvvv="#1" V="#1" RR="#0" B="#2" X="#2" b="0" aaa="#0" z="0"/>
+        <Opcode byte="8F"/>
+        <ModRM mode="11" reg="#0" rm="#2"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpshufbitqmb" xmm-mode="AVX">
+      <ISA id="AVX512BITALG"/>
+      <ISA id="AVX512VL"/>
+      <Operand type="k{k}" input="false" output="true"/>
+      <Operand type="ymm" input="true" output="false"/>
+      <Operand type="m256" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="01" W="0" vvvv="#1" V="#1" RR="#0" B="#2" X="#2" b="#2" aaa="#0" z="0" disp8xN="32"/>
+        <Opcode byte="8F"/>
+        <ModRM mode="#2" reg="#0" rm="#2"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpshufbitqmb" xmm-mode="AVX">
+      <ISA id="AVX512BITALG"/>
+      <ISA id="AVX512VL"/>
+      <Operand type="k{k}" input="false" output="true"/>
+      <Operand type="ymm" input="true" output="false"/>
+      <Operand type="ymm" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="01" W="0" vvvv="#1" V="#1" RR="#0" B="#2" X="#2" b="0" aaa="#0" z="0"/>
+        <Opcode byte="8F"/>
+        <ModRM mode="11" reg="#0" rm="#2"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpshufbitqmb" xmm-mode="AVX">
+      <ISA id="AVX512BITALG"/>
+      <Operand type="k{k}" input="false" output="true"/>
+      <Operand type="zmm" input="true" output="false"/>
+      <Operand type="m512" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="10" W="0" vvvv="#1" V="#1" RR="#0" B="#2" X="#2" b="#2" aaa="#0" z="0" disp8xN="64"/>
+        <Opcode byte="8F"/>
+        <ModRM mode="#2" reg="#0" rm="#2"/>
+      </Encoding>
+    </InstructionForm>
+    <InstructionForm gas-name="vpshufbitqmb" xmm-mode="AVX">
+      <ISA id="AVX512BITALG"/>
+      <Operand type="k{k}" input="false" output="true"/>
+      <Operand type="zmm" input="true" output="false"/>
+      <Operand type="zmm" input="true" output="false"/>
+      <Encoding>
+        <EVEX mm="10" pp="01" LL="10" W="0" vvvv="#1" V="#1" RR="#0" B="#2" X="#2" b="0" aaa="#0" z="0"/>
+        <Opcode byte="8F"/>
+        <ModRM mode="11" reg="#0" rm="#2"/>
+      </Encoding>
+    </InstructionForm>
+  </Instruction>
   <Instruction name="VPSHUFD" summary="Shuffle Packed Doublewords">
     <InstructionForm gas-name="vpshufd" xmm-mode="AVX">
       <ISA id="AVX512VL"/>
-- 
2.24.3 (Apple Git-128)

